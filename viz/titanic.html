<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <style type="text/css" media="screen, print">
        body {
            margin: 30px 50px;
            font-family: sans-serif;
        }
    </style>
    <title>Titanic</title>
</head>

<body>
    <h1>Titanic</h1>

    <script src="../vendor/d3/d3.js"></script>
    <script>
        var body = d3.select("body");


        var margin = {
            top: 10,
            left: 30,
            bottom: 20,
            right: 10
        };
        var width = 600 - margin.left - margin.right;
        var height = 400 - margin.top - margin.bottom;

        var numberOfPoints = 100;
        var pointRadius = 9;


        d3.tsv("../data/titanic.tsv", function(error, data) {
            if (error) throw error;

            var labels = d3.set(data.map(function(d) {
                return d.label;
            })).values();

            var xExtent = d3.extent(data, function(d) {
                return d.x
            });
            var yExtent = d3.extent(data, function(d) {
                return d.y
            });
            var xRange = xExtent[1] - xExtent[0];
            var yRange = yExtent[1] - yExtent[0];

            var xScale = d3.scale.linear()
                .domain([xExtent[0] - xRange * 0.1, xExtent[1] + xRange * 0.1])
                .range([0, width]);

            var yScale = d3.scale.linear()
                .domain([yExtent[0] - yRange * 0.1, yExtent[1] + yRange * 0.1])
                .range([height, 0]);

            var colourScale = d3.scale.ordinal()
                .domain(labels)
                .range(['#e41a1c', '#377eb8', '#4daf4a']);

            var shapeScale = d3.scale.ordinal()
                .domain(labels)
                .range([d3_shape.symbolCircle, d3_shape.symbolCross,
                    d3_shape.symbolSquare
                ]);

            var svg = d3.select('#container').append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .style('position', 'absolute')
                .style('z-index', 1)
                .append('g')
                .attr("transform", "translate(" + margin.left + "," +
                    margin.top + ")");



            var xAxis = d3.svg.axis()
                .scale(xScale)
                .innerTickSize(-height)
                .outerTickSize(0)
                .tickPadding(10)
                .orient('bottom');

            var yAxis = d3.svg.axis()
                .scale(yScale)
                .innerTickSize(-width)
                .outerTickSize(0)
                .orient('left');

            var xAxisSvg = svg.append('g')
                .attr('class', 'axis')
                .attr('transform', 'translate(0,' + height + ')')
                .call(xAxis);

            var yAxisSvg = svg.append('g')
                .attr('class', 'axis')
                .call(yAxis);

            function draw() {
                console.log('draw');

                context.clearRect(0, 0, width, height);

                data.forEach(function(d) {
                    var x = Math.round(xScale(d.x));
                    var y = Math.round(yScale(d.y));

                    var symbol = d3_shape.symbol()
                        .type(shapeScale(d.label))
                        .size(pointRadius * pointRadius)
                        .context(context);

                    context.translate(x, y);
                    context.fillStyle = colourScale(d.label);
                    context.beginPath();
                    symbol();
                    context.closePath();
                    context.fill();
                    context.stroke();
                    context.translate(-x, -y);
                });
            }



        });
    </script>
</body>

</html>